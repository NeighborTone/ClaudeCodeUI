---
name: checkpoint-plan
description: Create checkpoint-based implementation plan
allowed-tools: Read, Write, Glob, Grep, AskUserQuestion
---

# Checkpoint Plan Generator

チェックポイントベースの実装計画を作成するスキル。

## Usage

```
/checkpoint-plan [機能名]
```

機能名を省略した場合は、AskUserQuestionツールでユーザーに確認します。

## Workflow

### 1. 機能要件のヒアリング

AskUserQuestionツールを使用して以下を確認：

- 機能の概要と目的
- 影響範囲（コア層、UI層、ウィジェット層）
- 優先度（高/中/低）

### 2. タスク規模の判定

以下の基準でチェックポイントベースワークフローの適用を判断：

- 3つ以上のフェーズが必要か
- 複数日の作業が見込まれるか
- 5個以上のファイル変更が必要か
- 8個以上のコミットが予想されるか
- アーキテクチャ変更を含むか

### 3. フェーズとチェックポイントの分割

タスクを以下の観点で分割：

1. **論理的な単位**: 機能の自然な区切り
2. **依存関係**: 前のフェーズに依存する部分
3. **検証可能性**: 各チェックポイントで動作検証が可能
4. **時間**: 1チェックポイント = 1-2時間（標準粒度）

### 4. 計画書フォルダ構成の作成

`.claude/plan/task/[MAJOR]_plan_[機能名]/` に以下を作成：

#### 00_overview.md

- 全体概要
- フェーズ一覧
- 依存関係図
- 影響範囲
- リスク・注意点
- 成功基準

#### 01_phase1_xxx.md, 02_phase2_xxx.md, ...

各フェーズごとに以下を記述：

- フェーズの目標
- チェックポイント一覧（CP X-1, CP X-2, ...）
- 各チェックポイントの詳細：
  - タスク（サブタスク、変更ファイル、実装内容）
  - 実装詳細（コード例）
  - 検証手順
  - 完了条件
  - 次のチェックポイント

#### XX_progress.md

- 現在地
- Gitチェックポイント（コミットハッシュと状態）
- 完了フェーズ
- メモ・注意事項

#### XX_testing.md（オプション）

- 統合テスト計画
- テストケース
- 期待結果

### 5. ユーザー承認を待つ

計画書の内容をユーザーに提示し、承認を待ちます。

## Output Format

計画書フォルダ構成を提示：

```
✅ チェックポイントベース実装計画を作成しました

**計画書の場所:**
`.claude/plan/task/[MAJOR]_plan_[機能名]/`

**フェーズ構成:**
- Phase 1: [フェーズ名] (チェックポイント数: X個)
- Phase 2: [フェーズ名] (チェックポイント数: Y個)
- Phase 3: [フェーズ名] (チェックポイント数: Z個)

**推定時間:** X-Y日

**開始コマンド:**
承認後、「次のチェックポイント」または「CP 1-1 を実行」と指示してください。
```

## Example

### ユーザー入力

```
/checkpoint-plan ダークモード切り替え機能
```

### 出力

```
✅ チェックポイントベース実装計画を作成しました

**計画書の場所:**
`.claude/plan/task/[MAJOR]_plan_ダークモード切り替え/`

**フェーズ構成:**
- Phase 1: コア層実装 (チェックポイント数: 2個)
  - CP 1-1: テーマ切り替えロジックの実装 (1-2時間)
  - CP 1-2: テーマ設定の永続化 (1時間)
- Phase 2: UI層実装 (チェックポイント数: 3個)
  - CP 2-1: メニューアイテムの追加 (30分-1時間)
  - CP 2-2: 切り替えアクションの実装 (1-2時間)
  - CP 2-3: 全ウィジェットへのテーマ適用 (1-2時間)
- Phase 3: 統合テスト (チェックポイント数: 1個)
  - CP 3-1: 全テーマでの動作確認 (1-2時間)

**推定時間:** 2-3日

**開始コマンド:**
承認後、「次のチェックポイント」または「CP 1-1 を実行」と指示してください。
```

## Best Practices

### チェックポイント分割の例

**悪い例（大きすぎる）:**
- CP 1-1: ダークモード機能を全て実装（5-8時間）

**良い例（適切な粒度）:**
- CP 1-1: テーマ切り替えロジックの実装（1-2時間）
- CP 1-2: テーマ設定の永続化（1時間）
- CP 2-1: メニューアイテムの追加（30分-1時間）
- CP 2-2: 切り替えアクションの実装（1-2時間）

### ファイルパスの明記

各チェックポイントで変更するファイルを具体的に記載：

```markdown
## チェックポイント 1-1: テーマ切り替えロジックの実装（1-2時間） - **⬜ 未着手**

**タスク:**
- [ ] ThemeManagerクラスにdark_modeプロパティを追加
  - 変更ファイル: `src/core/settings_manager.py`
  - 実装内容: dark_mode設定の読み書きメソッド
- [ ] テーマ切り替えメソッドの実装
  - 変更ファイル: `src/ui/themes/theme_manager.py`
  - 実装内容: `toggle_dark_mode()` メソッド
```

### 検証手順の具体化

各チェックポイントで実施する検証手順を明確に：

```markdown
**検証:**
```bash
python3 main.py
```

手動確認:
1. アプリを起動
2. メニューバーから「テーマ」→「ダークモード切り替え」を選択
3. テーマがダークモードに切り替わることを確認
4. アプリを再起動
5. ダークモードが保持されていることを確認
```

## Notes

- このスキルは計画書の作成のみを行い、実装は行いません
- 実装は別途、ユーザーが「次のチェックポイント」と指示することで開始します
- 計画書の内容はユーザー承認後にいつでも修正可能です
